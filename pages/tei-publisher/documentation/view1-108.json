{
    "format": "json",
    "view": "div",
    "doc": "documentation.xml",
    "root": "3.29",
    "rootNode": "3.29",
    "id": "facets",
    "odd": "docbook.odd",
    "next": "3.31",
    "previous": "3.27.15",
    "nextId": "embedding",
    "previousId": "pi-config",
    "switchView": null,
    "content": "<!DOCTYPE html>\n<div class=\"content \"><div class=\"tei-section3\" id=\"facets\"><pb-observable data=\"3.29,3.29\" emit=\"transcription\">\n    <h1 class=\"tei-title6 title\">Facet Search Configuration</h1>\n    <p class=\"tei-para\">Facets allow users to quickly navigate through a set of documents or query results by\n        selecting from predefined categories or properties. This way, users can \"drill down\" into\n        the set, reducing the number of displayed items with every step. For demonstration purposes,\n        TEI Publisher configures two facets by default: \"Genre\" and \"Language\". You can see those to\n        the left of the document list on the start page, or below the search box on the search\n        result page.</p>\n    <figure class=\"tei-figure2 figure\"><span class=\"tei--element\">\n        <span class=\"tei--element\">\n          <img src=\"facets.png\" class=\"tei-imagedata2\" title=\"\">\n        </span>\n      </span><figcaption>Facets on the start page</figcaption></figure>\n    <p class=\"tei-para\">\n      From a user perspective, the main concept behind facets is the\n      <span class=\"tei-emphasis2\">drill\n          down</span>\n      : initially the user sees all facet values associated with the set of\n        documents or search results displayed. The number behind each value denotes the number of\n        items in the set having the particular facet set. As the user selects one facet, the set\n        necessarily becomes smaller, so non-matching facet values will disappear and the numbers\n        adjust accordingly.\n    </p>\n    <p class=\"tei-para\">\n      Facets are a new feature in eXist 5.0. They are super fast because eXist will create\n        them when indexing the document. No extra computation is needed when the user clicks on a\n        facet to drill down into a displayed set: all information is already available in the index.\n        To see a more complex example of facets in action, visit our\n      <a href=\"https://teipublisher.com/exist/apps/vangogh/index.html\" class=\"tei-link4\" target=\"_new\">Van Gogh</a>\n      demo.\n    </p>\n    <p class=\"tei-para\">If you would like to configure other or additional facets, you need to edit three\n        files:</p>\n    <dl><dt>\n          <span class=\"tei-filename code\">collection.xconf</span>\n        </dt><dd>\n          <p class=\"tei-para\">\n            The\n            <span class=\"tei-filename code\">collection.xconf</span>\n            tells eXist how to index the collection.\n              The default configuration in TEI Publisher creates two Lucene full-text indexes for\n              TEI on\n            <span class=\"tei-tag code\">tei:text</span>\n            and\n            <span class=\"tei-tag code\">tei:div</span>\n            . Each of those may have facets\n              attached. Every facet must have a\n            <span class=\"tei-parameter code\">dimension</span>\n            and an\n            <span class=\"tei-parameter code\">expression</span>\n            attribute. The expression is an arbitrary\n              XPath/XQuery string. For every element being indexed, the expression is evaluated once\n              and the result defines the string values which will be associated with the specified\n              facet dimension.\n          </p>\n          <p class=\"tei-para\">\n            For a description of how full-text indexes and facets are defined in the\n            <span class=\"tei-filename code\">collection.xconf</span>\n            , please refer to the\n            <a href=\"http://exist-db.org/exist/apps/doc/lucene\" class=\"tei-link4\" target=\"_new\">eXist\n              documentation</a>\n            .\n          </p>\n        </dd><dt>\n          <span class=\"tei-filename code\">index.xql</span>\n        </dt><dd>\n          <p class=\"tei-para\">\n            If you open the default\n            <span class=\"tei-filename code\">collection.xconf</span>\n            , you'll see that\n              most facet expressions call a function\n            <span class=\"tei-function code\">nav:get-metadata</span>\n            . This\n              function is declared in\n            <span class=\"tei-filename code\">index.xql</span>\n            . By externalizing most of the\n              code into a separate function, we can keep the index configuration clean and\n              short.\n          </p>\n          <p class=\"tei-para\">\n            The default\n            <span class=\"tei-filename code\">index.xql</span>\n            already does some advanced\n              preprocessing, in particular for the \"genre\" facet: each of the sample documents\n              references a central taxonomy (contained in\n            <span class=\"tei-filename code\">data/taxonomy.xml</span>\n            ).\n              The references are resolved at indexing time by following the\n            <span class=\"tei-tag code\">catRef</span>\n            element's\n            <span class=\"tei-parameter code\">@target</span>\n            attribute. Note that we create a hierarchical\n              facet, because e.g. \"Philosophy\" is a sub-category of \"Prose\". The code in function\n            <span class=\"tei-function code\">idx:get-genre</span>\n            will automatically include the\n              super-category.\n          </p>\n        </dd><dt>\n          <span class=\"tei-filename code\">config.xqm</span>\n        </dt><dd>\n          <p class=\"tei-para\">\n            While the other two files cover the server-side creation of facets, we also need a\n              place where we define how facets should be displayed in the user interface. The main\n              configuration module:\n            <span class=\"tei-filename code\">config.xqm</span>\n            declares a variable\n            <span class=\"tei-parameter code\">$config:facets</span>\n            . It should contain an array of maps, where\n              each map defines the settings for one dimension, e.g.:\n          </p>\n          <pb-code-highlight class=\"tei-programlisting5\" language=\"xquery\" line-numbers=\"line-numbers\">\n(:\n : Display configuration for facets to be shown in the sidebar. The facets themselves\n : are configured in the index configuration, collection.xconf.\n :)\ndeclare variable $config:facets := [\n    map {\n        \"dimension\": \"genre\",\n        \"heading\": \"Genre\",\n        \"max\": 5,\n        \"hierarchical\": true()\n    },\n    map {\n        \"dimension\": \"language\",\n        \"heading\": \"Language\",\n        \"max\": 5,\n        \"hierarchical\": false(),\n        \"output\": function($label) {\n            switch($label)\n                case \"de\" return \"German\"\n                case \"es\" return \"Spanish\"\n                case \"la\" return \"Latin\"\n                case \"fr\" return \"French\"\n                case \"en\" return \"English\"\n                default return $label\n        }\n    }\n];\n</pb-code-highlight>\n          <p class=\"tei-para\">The map properties are as follows:</p>\n          <dl><dt>dimension</dt><dd>\n                <p class=\"tei-para\">\n                  The name of the dimension. Should correspond to the value of the\n                  <span class=\"tei-parameter code\">@dimension</span>\n                  attribute used in\n                  <span class=\"tei-filename code\">collection.xconf</span>\n                </p>\n              </dd><dt>heading</dt><dd>\n                <p class=\"tei-para\">The heading to display above the facet values</p>\n              </dd><dt>max</dt><dd>\n                <p class=\"tei-para\">\n                  Maximum number of facet values to be displayed initially. More can be shown\n                    if the user clicks on the\n                  <span class=\"tei-guilabel\">Show All</span>\n                  checkbox. Pass an empty\n                    sequence, i.e. (), to not limit the number and hide the checkbox.\n                </p>\n              </dd><dt>hierarchical</dt><dd>\n                <p class=\"tei-para\">\n                  Defines if the facet is hierarchical, which means that only the top-level\n                    facet values in the hierarchy will be shown initially. If the user selects one\n                    top-level value, the interface will expand and show the sub-categories. For this\n                    to work the facet must be configured as \"hierarchical\" in\n                  <span class=\"tei-filename code\">collection.xconf</span>\n                </p>\n              </dd><dt>output</dt><dd>\n                <p class=\"tei-para\">A function which can be used to process the facet value before display. The\n                    facet label will be replaced by whatever the function returns.</p>\n              </dd></dl>\n        </dd></dl>\n  </pb-observable></div></div>",
    "footnotes": "",
    "userParams": {
        "webcomponents": 7
    },
    "collection": "doc"
}