{
    "format": "json",
    "view": "div",
    "doc": "documentation.xml",
    "root": "3.42.13",
    "rootNode": "3.42.13",
    "id": "annotations-config",
    "odd": "docbook.odd",
    "next": "3.42.13.63",
    "previous": "3.42.11.23",
    "nextId": "annotations-insert",
    "previousId": "connector-custom",
    "switchView": null,
    "content": "<!DOCTYPE html><html><head></head><body><div class=\"content \"><div class=\"tei-section4\" id=\"annotations-config\"><pb-observable data=\"3.42.13,3.42.13\" emit=\"transcription\"><h2 class=\"tei-title7 title\">Configuring Annotations</h2><div class=\"tei-note3 note\"><p class=\"tei-para\">TEI Publisher 9 introduces various changes to the annotation editor, including a different page layout. It also uses a sophisticated framework for forms, called <a href=\"https://jinntec.github.io/Fore/doc/index.html\" class=\"tei-link4\" target=\"_new\">Fore</a>, which is in particular used for the custom entity editors, but also powers some of the functionality of the main editor page. The user-customizable parts more or less stayed the same though, so updating an existing annotation app should be fairly easy (see the chapter on <pb-link class=\"tei-link3\" uri=\"?odd=docbook.odd&amp;view=div&amp;id=updating\" xml-id=\"updating\" emit=\"transcription\">updating</pb-link> from 8 to 9).</p></div><p class=\"tei-para\">Adding new annotation types or modifying existing ones involves the following three files within TEI Publisher or generated apps:</p><dl><dt><span class=\"tei-filename code\">templates/pages/annotate.html</span></dt><dd>\n            <p class=\"tei-para\">The HTML page for the annotation editor</p>\n          </dd><dt><span class=\"tei-filename code\">modules/annotation-config.xqm</span></dt><dd>\n            <p class=\"tei-para\">Defines how annotations are mapped to TEI</p>\n          </dd><dt><span class=\"tei-filename code\">odd/annotations.odd</span></dt><dd>\n            <p class=\"tei-para\">The ODD used to render the annotation text view. In generated apps this will live\n              in <span class=\"tei-filename code\">resources/odd/annotations.odd</span>.</p>\n          </dd></dl><p class=\"tei-para\">Let's assume we would like to support an annotation to tag foreign language passages\n        with the TEI <span class=\"tei-tag code\">foreign</span> element:</p><p class=\"tei-para\">First, open <span class=\"tei-filename code\">templates/pages/annotate.html</span> in eXide and locate the <span class=\"tei-tag code\"> div</span> with class <span class=\"tei--element\">header-toolbar</span>.\n        This is the main toolbar and you'll find the list of <span class=\"tei--element\">annotation-action</span> buttons in the second <span class=\"tei--element\">span.icon-group</span>. Like\n        many elements in TEI Publisher, <span class=\"tei-tag code\"> paper-icon-button</span> is a webcomponent from the polymer library, which renders a button compliant with Google's\n        material design. You could use any other button-type element here, but for consistency, let's stick with <span class=\"tei-tag code\">paper-icon-button</span>. We define our new\n        button like this:</p><pb-code-highlight class=\"tei-programlisting5\" language=\"xml\">&lt;paper-icon-button class=\"annotation-action toggle\" title=\"Foreign\" data-type=\"foreign\" icon=\"icons:language\" data-shortcut=\"⌘+⇧+b,ctrl+⇧+b\" disabled=\"disabled\"&gt;&lt;/paper-icon-button&gt;</pb-code-highlight><figure class=\"tei-figure2 figure\"><span class=\"tei--element\">\n          <span class=\"tei--element\">\n            <img src=\"ann-configure.png\" class=\"tei-imagedata2\" title=\"\" style=\"width: 800px; \">\n          </span>\n        </span><figcaption>Configure a new annotation type</figcaption></figure><p class=\"tei-para\">Make sure to include all the attributes shown:</p><dl><dt>class</dt><dd>\n            <p class=\"tei-para\">must at least contain <span class=\"tei--element\">annotation-action</span>. The <span class=\"tei--element\">toggle</span> indicates that this is a toggling annotation, which just\n              switches between on and off and does not need further input. For semantic annotations you can also add <span class=\"tei--element\">authority</span>, which would\n              trigger the authority lookup.</p>\n          </dd><dt>title</dt><dd>\n            <p class=\"tei-para\">a label to be shown when the mouse is moved over the button.</p>\n          </dd><dt>data-type</dt><dd>\n            <p class=\"tei-para\">indicates the annotation type.</p>\n          </dd><dt>icon</dt><dd>\n            <p class=\"tei-para\">the <a href=\"http://kevingleason.me/Polymer-Todo/bower_components/iron-icons/demo/index.html\" class=\"tei-link5\" target=\"\">material design icon</a> to use</p>\n          </dd><dt>data-shortcut</dt><dd>\n            <p class=\"tei-para\">an optional keyboard shortcut: here we use command-shift-b for Mac and\n              ctrl-shift-b on windows</p>\n          </dd><dt>disabled</dt><dd>\n            <p class=\"tei-para\">initially disables the button</p>\n          </dd></dl><p class=\"tei-para\">If you reload the annotation editor in the browser, you should now see your new button.\n        However, TEI Publisher does not yet know how to translate the new annotation into actual TEI\n        markup. To fix this, open <span class=\"tei-filename code\">modules/annotation-config.xqm</span> and search for\n        the function <span class=\"tei-function code\">anno:annotations</span>. This is a long switch statement with\n        cases corresponding to the different annotation types. Add a new case at the top:</p><pb-code-highlight class=\"tei-programlisting5\" language=\"xml\">declare function anno:annotations($type as xs:string, $properties as map(*), $content as function(*)) {\n    switch ($type)\n        case \"foreign\" return\n            &lt;foreign xmlns=\"http://www.tei-c.org/ns/1.0\"&gt;{$content()}&lt;/foreign&gt;\n    ...\n};</pb-code-highlight><p class=\"tei-para\">This will simply wrap a <span class=\"tei-tag code\">foreign</span> tag around the existing content. Note that\n          <span class=\"tei-parameter code\"> $content</span> is passed in as a function pointer, so it is important to\n        call it as <span class=\"tei-code2 code\"> $content()</span>. Also note how we need to declare the TEI namespace.\n        Without this namespace declaration, the element would not be recognized as TEI.</p><p class=\"tei-para\">Now we can try our new annotation: select a passage, click on the button and see how the\n        text is marked as an annotation. The color is chosen automatically. You can also check in\n        the TEI preview pane that the annotation is correctly output as a TEI <span class=\"tei-tag code\">foreign</span>\n        element.</p><p class=\"tei-para\">However, if you save the annotations, you'll notice that - once the annotation view\n        refreshes - the foreign text is rendered in italics, but not marked as an annotation! To fix\n        this, we need to modify the ODD used for rendering the annotation view.</p><p class=\"tei-para\">Open <span class=\"tei-filename code\">odd/annotations.odd</span> (named \"Annotations\"), either in eXide or\n        the ODD editor. Add an <span class=\"tei-tag code\">elementSpec</span> for element <span class=\"tei-tag code\">foreign</span> with an inline\n        model and a <span class=\"tei--element\">cssClass</span> containing <span class=\"tei-code2 code\">annotation\n        annotation-foreign</span>.</p><pb-code-highlight class=\"tei-programlisting5\" language=\"xml\">&lt;elementSpec ident=\"foreign\" mode=\"change\"&gt;\n    &lt;model behaviour=\"inline\" cssClass=\"annotation annotation-foreign\"/&gt;\n&lt;/elementSpec&gt;</pb-code-highlight><p class=\"tei-para\">If you like, you can also keep the <span class=\"tei-tag code\">outputRendition</span>, which renders the text in\n        italic. Key is that you declare the two <span class=\"tei-emphasis2\">annotation annotation-foreign</span>\n        CSS classes, because those will tell TEI Publisher that the element should be treated as an\n        annotation.</p><p class=\"tei-para\">As a general guideline, the ODD rules for annotations should produce simple inline tags.\n        They should output the content of the element without any modification. They may use <span class=\"tei-tag code\">\n          outputRendition</span> to change the appearance, or supply other parameters (than <span class=\"tei--element\">\n          content</span>).</p><p class=\"tei-para\">After saving the ODD, reloading the annotation editor should properly display the <span class=\"tei-tag code\">\n          foreign</span> as an annotation and we can start using our new annotation type.</p><p class=\"tei-para\">However, we may not be entirely happy with the simple on/off toggle: it would be much\n        better if we could also indicate the used language in <span class=\"tei-tag code\">foreign</span>. This means we have\n        to change our annotation from a mere toggle into one which can take an additional\n        parameter:</p><p class=\"tei-para\">To achieve this, go back to <span class=\"tei-filename code\">templates/pages/annotate.html</span> and\n        remove the <span class=\"tei--element\">toggle</span> class from the <span class=\"tei-tag code\">paper-icon-button</span>:</p><pb-code-highlight class=\"tei-programlisting5\" language=\"xml\">&lt;paper-icon-button class=\"annotation-action\" title=\"Foreign\" \n        data-type=\"foreign\" icon=\"icons:language\" data-shortcut=\"⌘+⇧+b,ctrl+⇧+b\"\n        disabled=\"disabled\"&gt;&lt;/paper-icon-button&gt;</pb-code-highlight><p class=\"tei-para\">We would also like to provide an input field into which the user can enter the language. Scroll down to the \"Annotation Details\" section in which\n        the <span class=\"tei-tag code\">form</span> for the annotation types is defined and add another input on top:</p><pb-code-highlight class=\"tei-programlisting5\" language=\"xml\">&lt;iron-form id=\"edit-form\"&gt;\n    &lt;form action=\"\"&gt;\n        &lt;paper-input class=\"annotation-form foreign\" name=\"lang\" label=\"Language\"&gt;&lt;/paper-input&gt;\n    ...\n&lt;/iron-form&gt;</pb-code-highlight><p class=\"tei-para\">Again we're using a webcomponent for the input to get the material design look and feel. The class attribute is particularly important: it must\n        always contain <span class=\"tei--element\">annotation-form</span>, followed by the annotation type: <span class=\"tei--element\">foreign</span>. The name is arbitrary, but should be unique\n        and we need to remember it for later. The label should contain a short title, which will be shown next to the input.</p><p class=\"tei-para\">Finally, we need to change our rule in\n          <span class=\"tei-filename code\">modules/annotation-config.xqm</span> to add the new parameter to the\n        generated <span class=\"tei-tag code\">foreign</span> element. Navigate to the file and change the\n          <span class=\"tei-function code\">anno:annotations</span> function as follows:</p><pb-code-highlight class=\"tei-programlisting5\" language=\"xml\">declare function anno:annotations($type as xs:string, $properties as map(*), $content as function(*)) {\n    switch ($type)\n        case \"foreign\" return\n            &lt;foreign xmlns=\"http://www.tei-c.org/ns/1.0\" xml:lang=\"{$properties?lang}\"&gt;{$content()}&lt;/foreign&gt;\n    ...\n};</pb-code-highlight><p class=\"tei-para\">The function receives all the parameters entered into the form fields in the <span class=\"tei--element\">$properties</span> map. In the form we used\n        <span class=\"tei-code2 code\">name=\"lang\"</span>, so the corresponding value is retrieved from the map with <span class=\"tei-code2 code\">$properties?lang</span>.</p><p class=\"tei-para\">That's all. You should now be able to modify your existing foreign annotation, enter a\n        language and see how it is output into TEI.</p></pb-observable></div></div></body></html>",
    "footnotes": "",
    "userParams": {
        "webcomponents": 7
    },
    "collection": "doc"
}