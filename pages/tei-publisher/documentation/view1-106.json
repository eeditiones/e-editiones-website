{
    "format": "json",
    "view": "div",
    "doc": "documentation.xml",
    "root": "3.28.15",
    "rootNode": "3.28.15",
    "id": "upgrade7-8",
    "odd": "docbook.odd",
    "next": "3.28.15.21",
    "previous": "3.28.13.15",
    "nextId": "other-changes7-8",
    "previousId": "upgrade-annotation-editor",
    "switchView": null,
    "content": "<!DOCTYPE html><html><head></head><body><div class=\"content \"><div class=\"tei-section4\" id=\"upgrade7-8\"><pb-observable data=\"3.28.15,3.28.15\" emit=\"transcription\"><h2 class=\"tei-title7 title\">Upgrading from TEI Publisher 7 to 8</h2><p class=\"tei-para\">With TEI Publisher 8, we have factored out a number of functions away from the\n        <span class=\"tei-code2 code\">modules/lib</span> to give users more control over their searches and presentation of\n      the search results, which requires porting these functions into query modules of older apps.\n      Recent breaking change to the <span class=\"tei-code2 code\">tei-publisher-lib</span>, a consequence of offering the\n      Print CSS as a default print output also requires some manual updates.</p><p class=\"tei-para\">The following changes have to be addressed during an update:</p><ol class=\"tei-orderedlist\"><li class=\"tei-listitem\">\n          <p class=\"tei-para\"><span class=\"tei-code2 code\">tei-publisher-lib</span> was updated to version 3, including breaking changes</p>\n        </li><li class=\"tei-listitem\">\n          <p class=\"tei-para\">version 1.x of the Open API library, roaster, requires namespace changes in module imports</p>\n        </li><li class=\"tei-listitem\">\n          <p class=\"tei-para\">navigation and search have been refactored</p>\n        </li></ol><p class=\"tei-para\">To upgrade a custom application generated with TEI Publisher 7 to version 8, we recommend to have the source code of both, TEI Publisher 8 and the\n        custom application, in a local directory.</p><p class=\"tei-para\">If you decide to work with the command line, as suggested here, clone TEI Publisher 8\n        into the directory one level above the one containing your own application source\n        code:</p><pb-code-highlight class=\"tei-programlisting5\" language=\"shell\">git clone https://github.com/eeditiones/tei-publisher-app.git\ncd tei-publisher-app\ngit checkout v8.0.0</pb-code-highlight><p class=\"tei-para\">With both applications in place, work through the following steps:</p><ol class=\"tei-procedure\"><li class=\"tei-step\">\n          <p class=\"tei-para\">Update the dependencies declared in the package descriptor file, <span class=\"tei-filename code\">expath-pkg.xml</span>: \n          this should include the following dependencies and versions:</p>\n          <pb-code-highlight class=\"tei-programlisting5\" language=\"xml\">&lt;dependency processor=\"http://exist-db.org\" semver-min=\"5.3.0\"/&gt;\n&lt;dependency package=\"http://exist-db.org/html-templating\" semver=\"1\"/&gt;\n&lt;dependency package=\"http://existsolutions.com/apps/tei-publisher-lib\" semver=\"3\"/&gt;\n&lt;dependency package=\"http://e-editiones.org/roaster\" semver=\"1\"/&gt;</pb-code-highlight>\n          <p class=\"tei-para\">If present, remove the dependencies on <span class=\"tei-code2 code\">http://exist-db.org/apps/shared</span> and\n            <span class=\"tei-code2 code\">http://exist-db.org/open-api/router</span>.</p>\n        </li><li class=\"tei-step\">\n          <p class=\"tei-para\">Update server-side modules: those live in <span class=\"tei-filename code\">modules/lib</span>. You can\n            safely remove the entire folder and replace it with the corresponding one from the new\n            version.</p>\n        </li><li class=\"tei-step\">\n          <p class=\"tei-para\">Update the webcomponents library to the latest 2.x.x release (also see the <a href=\"https://faq.teipublisher.com/webcomponents/version-upgrade/\" class=\"tei-link5\" target=\"\">faq</a>).\n            The version used is defined by a single variable in\n              <span class=\"tei-filename code\">modules/config.xqm</span> :</p>\n          <pb-code-highlight class=\"tei-synopsis4\" language=\"xquery\">declare variable $config:webcomponents := \"2.4.2\";</pb-code-highlight>\n          <p class=\"tei-para\">You may also want to switch to a different CDN. TEI Publisher by default used unpkg.com, which recently\n            became slightly unreliable. Change the corresponding variable to:</p>\n          <pb-code-highlight class=\"tei-synopsis4\" language=\"xquery\">declare variable $config:webcomponents-cdn := \"https://cdn.jsdelivr.net/npm/@teipublisher/pb-components\";</pb-code-highlight>\n        </li><li class=\"tei-step\">\n          <p class=\"tei-para\">Just updating to the new <span class=\"tei-code2 code\">tei-publisher-lib</span> version requires two changes:</p>\n          <ol class=\"tei-orderedlist\"><li class=\"tei-listitem\">\n              <p class=\"tei-para\">Update <span class=\"tei-code2 code\">resources/odd/configuration.xml</span></p>\n              <p class=\"tei-para\">If you registered any custom XQuery module in your\n                <span class=\"tei-code2 code\">resources/odd/configuration.xml</span> for the web output mode, make sure to\n                also enable this for the print output mode by copying the corresponding configuration\n                section as below </p>\n              <p class=\"tei-para\"> If you never touched this file or don't know what it is for: skip this step. </p>\n              \n              <pb-code-highlight class=\"tei-programlisting5\" language=\"xml\">\n            &lt;modules&gt;\n              &lt;output mode=\"web\"&gt;\n                &lt;module uri=\"http://karlbarth.ch/apps/kb/ext-html.xql\" prefix=\"ext-html\"\n                  at=\"xmldb:exist:///db/apps/kb/modules/ext-html.xql\"/&gt;\n              &lt;/output&gt;\n              &lt;!-- we need to add this because print extends web --&gt;\n              &lt;output mode=\"print\"&gt;\n                &lt;module uri=\"http://karlbarth.ch/apps/kb/ext-html.xql\" prefix=\"ext-html\"\n                  at=\"xmldb:exist:///db/apps/kb/modules/ext-html.xql\"/&gt;\n              &lt;/output&gt;\n            &lt;/modules&gt;\n              </pb-code-highlight>\n            </li><li class=\"tei-listitem\">\n              <p class=\"tei-para\">Change <span class=\"tei-filename code\">post-install.xql</span>. In the function <span class=\"tei-code2 code\">local:generate-code</span>\n                you'll find a list of output modes. Add <span class=\"tei-code2 code\">fo</span> to this list:</p>\n              <pb-code-highlight class=\"tei-programlisting5\" language=\"xquery\">\n                for $module in\n                  if ($pi?output) then\n                      tokenize($pi?output)\n                  else\n                      (\"web\", \"print\", \"latex\", \"epub\", \"fo\")\n              </pb-code-highlight>\n            </li></ol>\n        </li><li class=\"tei-step\">\n          <p class=\"tei-para\">Unless you applied changes to those files, copy all <span class=\"tei-filename code\">modules/query*.xql</span> and\n            <span class=\"tei-filename code\">modules/navigation*.xql</span> files. If you changed them, you'll need to diff and reapply\n            your modifications.</p>\n        </li><li class=\"tei-step\">\n          <p class=\"tei-para\">Copy <span class=\"tei-filename code\">modules/nlp-config.xqm</span> and <span class=\"tei-filename code\">modules/annotation-config.xqm</span>.</p>\n        </li><li class=\"tei-step\">\n          <p class=\"tei-para\">Check your <span class=\"tei-filename code\">modules/config.xqm</span> for differences. In particular the variable\n            <span class=\"tei--element\">$config:enable-proxy-caching</span> needs to be copied.</p>\n        </li><li class=\"tei-step\">\n          <p class=\"tei-para\">In <span class=\"tei-filename code\">modules/custom-api.xql</span> (and any other module with API endpoints), replace the\n            following import namespaces:</p>\n          <ul class=\"tei-itemizedlist\"><li class=\"tei-listitem\">\n              <p class=\"tei-para\">the <span class=\"tei-code2 code\">rutil</span> module import should be changed to:</p>\n              <pb-code-highlight class=\"tei-synopsis4\" language=\"xquery\">import module namespace rutil=\"http://e-editiones.org/roaster/util\";</pb-code-highlight>\n            </li><li class=\"tei-listitem\">\n              <p class=\"tei-para\">and the <span class=\"tei-code2 code\">errors</span> module import:</p>\n              <pb-code-highlight class=\"tei-synopsis4\" language=\"xquery\">import module namespace errors = \"http://e-editiones.org/roaster/errors\";</pb-code-highlight>\n            </li></ul>\n          <p class=\"tei-para\">Also, if your <span class=\"tei-filename code\">module/custom-api.json</span> file uses the <span class=\"tei-code2 code\">groups</span> property\n            anywhere, you need to change it to an array instead of a string, e.g.:</p>\n          <pb-code-highlight class=\"tei-programlisting5\" language=\"json\">\n        \"x-constraints\": {\n\t\t\t\t\t\"groups\": [\"tei\"]\n\t\t\t\t},</pb-code-highlight>\n        </li><li class=\"tei-step\">\n          <p class=\"tei-para\">Copy <span class=\"tei-filename code\">templates/documents.html</span> into the corresponding folder of your custom app.</p> \n        </li></ol></pb-observable></div></div></body></html>",
    "footnotes": "",
    "userParams": {
        "webcomponents": 7
    },
    "collection": "doc"
}